#!/bin/bash
# GoX WASM Build Script
# Generated by goxc

echo "Building WASM components..."

# Set WASM build environment
export GOOS=js
export GOARCH=wasm

# Find all _wasm.go files
for file in examples/wasm/dist/*_wasm.go; do
    if [ -f "$file" ]; then
        base=$(basename "$file" _wasm.go)
        echo "Compiling $base to WASM..."
        go build -o "examples/wasm/dist/${base}.wasm" "$file"

        if [ $? -eq 0 ]; then
            echo "✓ Generated ${base}.wasm"
        else
            echo "✗ Failed to compile ${base}"
            exit 1
        fi
    fi
done

# Copy WASM support file
if [ ! -f "examples/wasm/dist/wasm_exec.js" ]; then
    echo "Copying wasm_exec.js..."
    cp "$(go env GOROOT)/misc/wasm/wasm_exec.js" "examples/wasm/dist/"
fi

echo ""
echo "WASM build complete!"
echo "Files generated in: examples/wasm/dist"
echo ""
echo "To serve your WASM component:"
echo "1. Include wasm_exec.js in your HTML"
echo "2. Load and instantiate the .wasm file"
echo ""
echo "Example HTML:"
echo '<!DOCTYPE html>'
echo '<html>'
echo '<head>'
echo '    <script src="wasm_exec.js"></script>'
echo '    <script>'
echo '        const go = new Go();'
echo '        WebAssembly.instantiateStreaming(fetch("component.wasm"), go.importObject).then((result) => {'
echo '            go.run(result.instance);'
echo '        });'
echo '    </script>'
echo '</head>'
echo '<body>'
echo '    <div id="root"></div>'
echo '</body>'
echo '</html>'
